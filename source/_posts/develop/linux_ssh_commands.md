---
title: linux之ssh命令
date: 2017-12-08 20:12:12
categories:
- 网页开发

tags:
- Linux
---

# 前言
今天需要使用ssh的时候发现居然不好使了，原来是自己在电脑上用了lantern之后，ip被改了，不在一个局域网内，无法访问非公网ip。（主要是根本ping不同目的主机= =）
于是打算借着机会好好的梳理一下ssh命令。

<!-- more -->
# 参考链接
[ssh用法及命令](http://blog.csdn.net/pipisorry/article/details/52269785)
# 结束语
为什么这篇文章的结束语这么靠前，是因为，我在看完大段的内容之后依旧无法弄清楚。如果我要将远端的8000端口映射到本地的8888端口我该用什么命令。感觉这样子陈列知识点真的很糟糕。还是应该以具体的应用来说比较好。
```bash
ssh -L 8888:localhost:8000 remote#remote是远端主机名
ssh -p 8888 localhost#此时ssh登陆本机8888端口就相当于登陆了remote了，稍后可以一试：）
```

# 什么是SSH
首先，需要明确的是：SSH是一种网络协议，用于计算机之间的加密登录。目前已经成为Linux系统的标准配置。

SSH只是一种协议，存在多种实现，既有商业实现，也有开源实现。本文针对的实现是OpenSSH，它是自由软件，应用非常广泛。这里只讨论SSH在Linux Shell中的用法。如果要在Windows系统中使用SSH，会用到另一种软件PuTTY。
> 注解：SSH只是一种协议，而我们所用的SSH命令则是基于该工具封装的一种命令行工具（linux shell）。
> PuTTY是一个实现这些协议的图形化工具（它支持的协议不止有SSH）

# SSH原理
SSH之所以能够保证安全，原因在于它采用了公钥加密。整个过程是这样的：
（1）远程主机收到用户的登录请求，把自己的公钥发给用户。
（2）用户使用这个公钥，将登录密码加密后，发送回来。
（3）远程主机用自己的私钥，解密登录密码，如果密码正确，就同意用户登录。
> 不像https协议，SSH协议的公钥是没有证书中心（CA）公证的，也就是说，都是自己签发的。

## 中间人攻击
可以设想，如果攻击者插在用户与远程主机之间（比如在公共的wifi区域），用伪造的公钥，获取用户的登录密码。再用这个密码登录远程主机，那么SSH的安全机制就荡然无存了。这种风险就是著名的"中间人攻击"（Man-in-the-middle attack）

# SSH基本用法
## SSH远程登录
口令登录
```bash
#假定你要以用户名user，登录远程主机host，只要一条简单命令就可以了。
$ ssh user@host  如：ssh pika@192.168.0.111
#如果本地用户名与远程用户名一致，登录时可以省略用户名。
$ ssh host
#SSH的默认端口是22，也就是说，你的登录请求会送进远程主机的22端口。使用p参数，可以修改这个端口
$ ssh -p 2222 user@host
```

## 公钥登录
所谓"公钥登录"，原理很简单，就是用户将自己的公钥储存在远程主机上。登录的时候，远程主机会向用户发送一段随机字符串，用户用自己的私钥加密后，再发回来。远程主机用事先储存的公钥进行解密，如果成功，就证明用户是可信的，直接允许登录shell，不再要求密码。
**这种方法要求用户必须提供自己的公钥。如果没有现成的，可以直接用ssh-keygen生成一个**
```bash
$ ssh-keygen
# 运行结束以后，在$HOME/.ssh/目录下，会新生成两个文件：id_rsa.pub和id_rsa。前者是你的公钥，后者是你的私钥。

# 这时再输入下面的命令，将公钥传送到远程主机host上面：
$ ssh-copy-id user@host
```
## 使用ssh在远程后台不中断地跑程序
使用nohup命令让程序在关闭窗口（切换SSH连接）的时候程序还能继续在后台运行
```bash
nohup python3 a.py &
```
# SSH远程操作
## SSH数据传输
SSH不仅可以用于远程主机登录，还可以直接在远程主机上执行操作。
SSH可以在用户和远程主机之间，建立命令和数据的传输通道，因此很多事情都可以通过SSH来完成。

## scp 跨机远程拷贝
scp是secure copy的简写，用于在Linux下进行远程拷贝文件的命令，和它类似的命令有cp，不过cp只是在本机进行拷贝不能跨服务器，而且scp传输是加密的。可能会稍微影响一下速度。
**两台主机之间复制文件必需得同时有两台主机的复制执行帐号和操作权限**。
> 注解：建议使用scp进行远程copy

## 绑定本地端口
可以让那些不加密的网络连接，全部改走SSH连接，从而提高安全性。
```bash
#假定我们要让8080端口的数据，都通过SSH传向远程主机，命令就这样写：
$ ssh -D 8080 user@host
```
> SSH会建立一个socket，去监听本地的8080端口。一旦有数据传向那个端口，就自动把它转移到SSH连接上面，发往远程主机。
> 可以想象，如果8080端口原来是一个不加密端口，现在将变成一个加密端口。

## 本地端口转发
有时，绑定本地端口还不够，还必须指定数据传送的目标主机，从而形成**点对点的"端口转发"**。
为了区别后文的"远程端口转发"，我们把这种情况称为"本地端口转发"（Local forwarding）

## 远程端口转发
既然"本地端口转发"是指绑定本地端口的转发，那么"远程端口转发"（remote forwarding）当然是指绑定远程端口的转发。